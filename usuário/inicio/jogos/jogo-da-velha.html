<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Velha - SLICED</title>
    <link rel="icon" href="/imgs/LOGO-SLICED.png" type="image/png">

    <!-- Link para o CSS Externo -->
    <link rel="stylesheet" href="jogo-da-velha.css">

    <!-- Fontes e √çcones -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
    
    <!-- Cabe√ßalho Principal -->
    <div class="header">
        <h1>‚öîÔ∏è Jogo da Velha <span class="header-badge">ULTIMATE</span></h1>
        <p>Aposte valores, ven√ßa a melhor de 3 ou sobreviva √† Morte S√∫bita!</p>
    </div>

    <div class="container">

        <!-- (REMOVIDO O BOT√ÉO DE VOLTAR DAQUI) -->

        <!-- =========================================
             VIEW 1: LOBBY P√öBLICO
             ========================================= -->
        <div id="lobbyView" class="view-section">
            <div class="bet-grid" id="betGrid"></div>
            
            <div class="custom-match-container">
                <div class="custom-match-card" onclick="goToPrivateMode()">
                    <div class="custom-icon">ü§ù</div>
                    <div class="custom-content">
                        <h3>Jogar com Amigos</h3>
                        <p>Crie uma sala privada ou entre com um c√≥digo</p>
                    </div>
                    <div class="custom-arrow">‚ûî</div>
                </div>
            </div>
        </div>

        <!-- =========================================
             VIEW 2: MODO PRIVADO
             ========================================= -->
        <div id="privateSetupView" class="view-section" style="display: none;">
            <div class="private-header">
                <button class="btn-back" onclick="backToPublicLobby()">
                    <i class="material-icons">arrow_back</i> Voltar ao Lobby
                </button>
                <h2 style="text-align:center; width:100%; margin-top:10px;">Modo Privado</h2>
            </div>

            <div id="privateStep1" class="private-step">
                <div class="private-options-grid">
                    <div class="private-option-card create" onclick="showPrivateBetSelection()">
                        <div class="icon">‚ú®</div>
                        <h3>Criar Sala</h3>
                        <p>Escolha um valor e gere um c√≥digo.</p>
                    </div>
                    <div class="private-option-card join">
                        <div class="icon">üöÄ</div>
                        <h3>Entrar na Sala</h3>
                        <p>Digite o c√≥digo para conectar.</p>
                        <div class="join-input-group">
                            <input type="text" id="roomCodeInput" placeholder="C√ìDIGO" maxlength="6">
                            <button onclick="joinPrivateRoom()">Conectar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="privateStep2" class="private-step" style="display: none;">
                <h3 style="text-align:center;">Quanto vale essa disputa?</h3>
                <div class="bet-grid" id="privateBetGrid"></div>
                <button class="btn-text" onclick="backToPrivateStep1()">Cancelar Sele√ß√£o</button>
            </div>

            <div id="privateStep3" class="private-step" style="display: none;">
                <div class="waiting-card private">
                    <h3>Sala Criada!</h3>
                    <p>Compartilhe o c√≥digo:</p>
                    <div class="code-box">
                        <span id="displayRoomCode">------</span>
                        <button onclick="copyRoomCode()">COPIAR</button>
                    </div>
                    <div class="loader-container">
                        <div class="spinner-small"></div>
                        <span>Aguardando oponente...</span>
                    </div>
                    <button class="btn-cancel" onclick="cancelPrivateRoom()">Cancelar Sala</button>
                </div>
            </div>
        </div>

        <!-- =========================================
             VIEW 3: LOADING
             ========================================= -->
        <div id="waitingView" class="view-section" style="display: none;">
            <div class="waiting-card">
                <div class="spinner"></div>
                <div class="waiting-text">Procurando Oponente...</div>
                <p id="waitingSubText" style="color: #aaa;">Aguardando desafiante...</p>
                <button class="btn-cancel" style="margin-top: 20px;" onclick="location.reload()">Cancelar</button>
            </div>
        </div>

        <!-- =========================================
             VIEW 4: JOGO
             ========================================= -->
        <div id="gameView" class="view-section" style="display: none;">
            <div class="scoreboard">
                <div class="score-card p1">
                    <span id="scoreP1Name">Jog 1</span>
                    <strong id="scoreP1Value">0</strong>
                </div>
                <div class="round-display">
                    <span>RODADA</span>
                    <strong id="currentRoundDisplay">1 / 3</strong>
                </div>
                <div class="score-card p2">
                    <span id="scoreP2Name">Jog 2</span>
                    <strong id="scoreP2Value">0</strong>
                </div>
            </div>

            <div class="game-header">
                <div class="player-info">
                    <div class="player-name" id="p1Name">Voc√™</div>
                    <div class="player-symbol">X</div>
                </div>
                <div class="game-info">
                    <div class="turn-info" id="turnDisplay">Carregando...</div>
                    <div class="timer-container" id="timerContainer">
                        <div class="timer-bar-bg">
                            <div class="timer-bar" id="timerBar"></div>
                        </div>
                        <div class="timer-text" id="timerText">10</div>
                    </div>
                </div>
                <div class="player-info">
                    <div class="player-name" id="p2Name">Oponente</div>
                    <div class="player-symbol">O</div>
                </div>
            </div>

            <div class="board" id="board"></div>
        </div>

        <!-- OVERLAY: MORTE S√öBITA -->
        <div class="sudden-death-container" id="suddenDeathContainer">
            <div class="sd-header">
                <h2>‚ö†Ô∏è MORTE S√öBITA ‚ö†Ô∏è</h2>
                <p>CLIQUE NA LETRA <span style="color:#4ade80; font-weight:900; font-size:1.5rem;">'P'</span> PARA VENCER!</p>
            </div>
            <div class="matrix-grid" id="matrixGrid"></div>
        </div>

        <!-- MODAL: RESULTADO -->
        <div class="result-modal" id="resultModal">
            <div class="result-content">
                <div class="result-icon" id="resultIcon">üèÜ</div>
                <div class="result-title" id="resultTitle">FIM DE JOGO</div>
                <div class="result-message" id="resultMessage">Resultado da partida</div>
                <button class="btn" onclick="backToMenu()">Voltar ao Menu</button>
            </div>
        </div>
        
        <!-- MODAL: REGRAS -->
        <div id="rulesModal" class="result-modal">
            <div class="result-content" style="text-align: left; max-width: 500px;">
                <div class="rules-header">
                    <h3 style="color: #fff; font-size: 1.8rem; margin-bottom: 20px; text-align: center;">üìú Regras do Jogo</h3>
                </div>
                <div class="rules-body" style="color: #ccc; font-size: 0.95rem; line-height: 1.6;">
                    <p><strong>1. Objetivo:</strong> Alinhar 3 s√≠mbolos iguais.</p>
                    <p style="margin-top:10px;"><strong>2. Partida:</strong> Melhor de 3 rodadas.</p>
                    <p style="margin-top:10px;"><strong>3. Morte S√∫bita:</strong> Em caso de empate total, clique no 'P' na chuva de letras.</p>
                </div>
                <button class="btn" style="margin-top: 25px; width: 100%;" onclick="toggleRules()">Entendi</button>
            </div>
        </div>

    </div>

    <!-- =========================================
         BOTTOM NAVBAR (Atualizada: 3 Itens)
         ========================================= -->
    <nav class="bottom-navbar">
        <div class="nav-item active" onclick="closeRules()">
            <i class="material-icons">sports_esports</i>
            <span>Jogo</span>
        </div>
        <div class="nav-item" onclick="toggleRules()">
            <i class="material-icons">menu_book</i>
            <span>Regras</span>
        </div>
        <!-- Novo Item: SAIR -->
        <div class="nav-item" onclick="window.location.href='/usu√°rio/inicio/inicio.html'">
            <i class="material-icons">exit_to_app</i>
            <span>Sair</span>
        </div>
    </nav>

    <!-- JS de UI -->
    <script>
        function toggleRules() {
            const modal = document.getElementById('rulesModal');
            const navItems = document.querySelectorAll('.nav-item');
            
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
                navItems[0].classList.add('active'); // Ativa Jogo
                navItems[1].classList.remove('active'); // Desativa Regras
            } else {
                modal.style.display = 'flex';
                navItems[0].classList.remove('active'); // Desativa Jogo
                navItems[1].classList.add('active'); // Ativa Regras
            }
            // Item 3 (Sair) n√£o precisa de estado active pois sai da p√°gina
        }

        function closeRules() {
            document.getElementById('rulesModal').style.display = 'none';
            const navItems = document.querySelectorAll('.nav-item');
            navItems[0].classList.add('active');
            navItems[1].classList.remove('active');
        }
    </script>

    <script type="module" src="./jogo-da-velha.js"></script>
</body>
</html>