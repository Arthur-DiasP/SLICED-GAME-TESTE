<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Velha - SLICED</title>
    <link rel="icon" href="/imgs/LOGO-SLICED.png" type="image/png">

    <!-- Link para o CSS Externo -->
    <link rel="stylesheet" href="jogo-da-velha.css">
    <link rel="stylesheet" href="sx-modal-styles.css">
    <link rel="stylesheet" href="../../../controle-dados/balance-widget.css">

    <!-- Fontes e √çcones -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
    
    
    <!-- Cabe√ßalho Principal -->
    <div class="header">
        <div class="header-content">
            <h1>‚öîÔ∏è Jogo da Velha <span class="header-badge">ULTIMATE</span></h1>
            <p>Aposte valores, ven√ßa a melhor de 3 ou sobreviva √† Morte S√∫bita!</p>
        </div>
        
        <!-- Widget de Saldo -->
        <div id="balance-widget" class="balance-widget"></div>
    </div>

    <div class="container">

        <!-- MODAL DE SELE√á√ÉO OBRIGAT√ìRIA DO S√ìCIO SX -->
        <div id="sxSelectionModal" class="sx-modal" style="display: none;">
            <div class="sx-modal-content">
                <div class="sx-modal-header">
                    <div class="sx-modal-icon">‚≠ê</div>
                    <h2>Escolha um S√≥cio SX</h2>
                    <p>Selecione um s√≥cio para continuar.</p>
                </div>
                
                <div class="sx-modal-gallery" id="sxModalGallery">
                    <div class="sx-loading">Carregando s√≥cios...</div>
                </div>
                
                <div class="sx-modal-selected" id="sxModalSelected" style="display: none;">
                    <div class="selected-sx-card">
                        <img id="selectedSxImage" class="selected-sx-img" src="" alt="SX">
                        <div class="selected-sx-info">
                            <strong id="selectedSxName">Nenhum selecionado</strong>
                            <span id="selectedSxCategory"></span>
                        </div>
                        <div class="selected-sx-badge">‚úì</div>
                    </div>
                </div>
                
                <button id="btnConfirmSX" class="btn-confirm-sx" style="display: none;">
                    CONTINUAR PARA O JOGO
                </button>
            </div>
        </div>

        <!-- =========================================
             VIEW 1: LOBBY P√öBLICO
             ========================================= -->
        <div id="lobbyView" class="view-section">
            <div class="bet-grid" id="betGrid"></div>
            
            <div class="custom-match-container">
                <div class="custom-match-card" onclick="goToPrivateMode()">
                    <div class="custom-icon">ü§ù</div>
                    <div class="custom-content">
                        <h3>Jogar com Amigos</h3>
                        <p>Crie uma sala privada ou entre com um c√≥digo</p>
                    </div>
                    <div class="custom-arrow">‚ûî</div>
                </div>
            </div>
        </div>

        <!-- =========================================
             VIEW 2: MODO PRIVADO
             ========================================= -->
        <div id="privateSetupView" class="view-section" style="display: none;">
            <div class="private-header">
                <button class="btn-back" onclick="backToPublicLobby()">
                    <i class="material-icons">arrow_back</i> Voltar ao Lobby
                </button>
                <h2 style="text-align:center; width:100%; margin-top:10px;">Modo Privado</h2>
            </div>

            <div id="privateStep1" class="private-step">
                <div class="private-options-grid">
                    <div class="private-option-card create" onclick="showPrivateBetSelection()">
                        <div class="icon">‚ú®</div>
                        <h3>Criar Sala</h3>
                        <p>Escolha um valor e gere um c√≥digo.</p>
                    </div>
                    <div class="private-option-card join">
                        <div class="icon">üöÄ</div>
                        <h3>Entrar na Sala</h3>
                        <p>Digite o c√≥digo para conectar.</p>
                        <div class="join-input-group">
                            <input type="text" id="roomCodeInput" placeholder="C√ìDIGO" maxlength="6">
                            <button onclick="joinPrivateRoom()">Conectar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="privateStep2" class="private-step" style="display: none;">
                <h3 style="text-align:center;">Quanto vale essa disputa?</h3>
                <div class="bet-grid" id="privateBetGrid"></div>
                <button class="btn-text" onclick="backToPrivateStep1()">Cancelar Sele√ß√£o</button>
            </div>

            <div id="privateStep3" class="private-step" style="display: none;">
                <div class="waiting-card private">
                    <h3>Sala Criada!</h3>
                    <p>Compartilhe o c√≥digo:</p>
                    <div class="code-box">
                        <span id="displayRoomCode">------</span>
                        <button onclick="copyRoomCode()">COPIAR</button>
                    </div>
                    <div class="loader-container">
                        <div class="spinner-small"></div>
                        <span>Aguardando oponente...</span>
                    </div>
                    <button class="btn-cancel" onclick="cancelPrivateRoom()">Cancelar Sala</button>
                </div>
            </div>
        </div>

        <!-- =========================================
             VIEW 3: LOADING
             ========================================= -->
        <div id="waitingView" class="view-section" style="display: none;">
            <div class="waiting-card">
                <div class="spinner"></div>
                <div class="waiting-text">Procurando Oponente...</div>
                <p id="waitingSubText" style="color: #aaa;">Aguardando desafiante...</p>
                <button class="btn-cancel" style="margin-top: 20px;" onclick="location.reload()">Cancelar</button>
            </div>
        </div>

        <!-- =========================================
             VIEW 3.5: ANIMA√á√ÉO DE MATCHMAKING
             ========================================= -->
        <div id="matchmakingView" class="view-section" style="display: none;">
            <div class="matchmaking-container">
                <!-- Cabe√ßalho com valor da aposta -->
                <div class="matchmaking-bet-display">
                    <div class="bet-label">SALA</div>
                    <div class="bet-value" id="matchmakingBetValue">R$ 0,00</div>
                </div>

                <!-- Players -->
                <div class="matchmaking-players">
                    <div class="matchmaking-player player-left">
                        <div class="player-avatar">
                            <div class="avatar-circle p1">
                                <span class="avatar-symbol">X</span>
                            </div>
                        </div>
                        <div class="player-name" id="matchmakingPlayer1Name">Jogador 1</div>
                        <div class="player-entry-fee" id="matchmakingPlayer1Fee">R$ 0,00</div>
                    </div>

                    <div class="matchmaking-vs">
                        <div class="vs-text">VS</div>
                        <div class="vs-line"></div>
                    </div>

                    <div class="matchmaking-player player-right">
                        <div class="player-avatar">
                            <div class="avatar-circle p2">
                                <span class="avatar-symbol">O</span>
                            </div>
                        </div>
                        <div class="player-name" id="matchmakingPlayer2Name">Jogador 2</div>
                        <div class="player-entry-fee" id="matchmakingPlayer2Fee">R$ 0,00</div>
                    </div>
                </div>

                <!-- Anima√ß√£o de Moedas -->
                <div class="coins-animation">
                    <div class="coin coin-left">
                        <div class="coin-inner">
                            <span class="coin-value" id="coinLeftValue">R$ 0,00</span>
                        </div>
                    </div>
                    <div class="coin coin-right">
                        <div class="coin-inner">
                            <span class="coin-value" id="coinRightValue">R$ 0,00</span>
                        </div>
                    </div>
                    <div class="coin-total" id="coinTotal">
                        <div class="total-glow"></div>
                        <span id="coinTotalValue">R$ 0,00</span>
                    </div>
                </div>

                <!-- Mensagem de in√≠cio -->
                <div class="matchmaking-message">
                    <p>Partida encontrada!</p>
                    <p class="message-sub">Preparando tabuleiro...</p>
                </div>
            </div>
        </div>

        <!-- =========================================
             VIEW 4: JOGO
             ========================================= -->
        <div id="gameView" class="view-section" style="display: none;">
            <div class="scoreboard">
                <div class="score-card p1">
                    <span id="scoreP1Name">Jog 1</span>
                    <strong id="scoreP1Value">0</strong>
                </div>
                <div class="round-display">
                    <span>RODADA</span>
                    <strong id="currentRoundDisplay">1 / 3</strong>
                </div>
                <div class="score-card p2">
                    <span id="scoreP2Name">Jog 2</span>
                    <strong id="scoreP2Value">0</strong>
                </div>
            </div>

            <div class="game-header">
                <div class="player-info">
                    <div class="player-name" id="p1Name">Voc√™</div>
                    <div class="player-symbol">X</div>
                </div>
                <div class="game-info">
                    <div class="turn-info" id="turnDisplay">Carregando...</div>
                    <div class="timer-container" id="timerContainer">
                        <div class="timer-bar-bg">
                            <div class="timer-bar" id="timerBar"></div>
                        </div>
                        <div class="timer-text" id="timerText">10</div>
                    </div>
                </div>
                <div class="player-info">
                    <div class="player-name" id="p2Name">Oponente</div>
                    <div class="player-symbol">O</div>
                </div>
            </div>

            <div class="board" id="board"></div>
        </div>

        <!-- OVERLAY: MORTE S√öBITA -->
        <div class="sudden-death-container" id="suddenDeathContainer">
            <div class="sd-header">
                <h2>‚ö†Ô∏è MORTE S√öBITA ‚ö†Ô∏è</h2>
                <p>CLIQUE NA LETRA <span style="color:#4ade80; font-weight:900; font-size:1.5rem;">'P'</span> PARA VENCER!</p>
            </div>
            <div class="matrix-grid" id="matrixGrid"></div>
        </div>

        <!-- MODAL: RESULTADO -->
        <div class="result-modal" id="resultModal">
            <div class="result-content">
                <div class="result-icon" id="resultIcon">üèÜ</div>
                <div class="result-title" id="resultTitle">FIM DE JOGO</div>
                <div class="result-message" id="resultMessage">Resultado da partida</div>
                <button class="btn" onclick="backToMenu()">Voltar ao Menu</button>
            </div>
        </div>
        
        <!-- MODAL: REGRAS -->
        <div id="rulesModal" class="result-modal">
            <div class="result-content" style="text-align: left; max-width: 500px;">
                <div class="rules-header">
                    <h3 style="color: #fff; font-size: 1.8rem; margin-bottom: 20px; text-align: center;">üìú Regras do Jogo</h3>
                </div>
                <div class="rules-body" style="color: #ccc; font-size: 0.95rem; line-height: 1.6;">
                    <p><strong>1. Objetivo:</strong> Alinhar 3 s√≠mbolos iguais.</p>
                    <p style="margin-top:10px;"><strong>2. Partida:</strong> Melhor de 3 rodadas.</p>
                    <p style="margin-top:10px;"><strong>3. Morte S√∫bita:</strong> Em caso de empate total, clique no 'P' na chuva de letras.</p>
                    <p style="margin-top:10px;"><strong>4. Entrada:</strong> Cada jogador paga metade do valor da sala para entrar.</p>
                    <p style="margin-top:10px;"><strong>5. Pr√™mio:</strong> O vencedor recebe <span style="color: #4ade80; font-weight: 700;">80%</span> do valor total da sala. A plataforma fica com <span style="color: #fbbf24; font-weight: 700;">20%</span> como taxa de servi√ßo.</p>
                    <div style="margin-top: 15px; padding: 12px; background: rgba(74, 222, 128, 0.1); border-left: 3px solid #4ade80; border-radius: 6px;">
                        <p style="font-size: 0.85rem; margin: 0;"><strong>Exemplo:</strong> Sala de R$ 10,00</p>
                        <p style="font-size: 0.85rem; margin: 5px 0 0 0;">‚Ä¢ Entrada: R$ 5,00 por jogador</p>
                        <p style="font-size: 0.85rem; margin: 5px 0 0 0;">‚Ä¢ Pr√™mio do vencedor: R$ 8,00 (80%)</p>
                        <p style="font-size: 0.85rem; margin: 5px 0 0 0;">‚Ä¢ Taxa da plataforma: R$ 2,00 (20%)</p>
                    </div>
                </div>
                <button class="btn" style="margin-top: 25px; width: 100%;" onclick="toggleRules()">Entendi</button>
            </div>
        </div>

    </div>

    <!-- =========================================
         BOTTOM NAVBAR (Atualizada: 3 Itens)
         ========================================= -->
    <nav class="bottom-navbar">
        <div class="nav-item active" onclick="closeRules()">
            <i class="material-icons">sports_esports</i>
            <span>Jogo</span>
        </div>
        <div class="nav-item" onclick="toggleRules()">
            <i class="material-icons">menu_book</i>
            <span>Regras</span>
        </div>
        <!-- Novo Item: SAIR -->
        <div class="nav-item" onclick="window.location.href='/usu√°rio/inicio/inicio.html'">
            <i class="material-icons">exit_to_app</i>
            <span>Sair</span>
        </div>
    </nav>

    <!-- JS de UI -->
    <script>
        function toggleRules() {
            const modal = document.getElementById('rulesModal');
            const navItems = document.querySelectorAll('.nav-item');
            
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
                navItems[0].classList.add('active'); // Ativa Jogo
                navItems[1].classList.remove('active'); // Desativa Regras
            } else {
                modal.style.display = 'flex';
                navItems[0].classList.remove('active'); // Desativa Jogo
                navItems[1].classList.add('active'); // Ativa Regras
            }
            // Item 3 (Sair) n√£o precisa de estado active pois sai da p√°gina
        }

        function closeRules() {
            document.getElementById('rulesModal').style.display = 'none';
            const navItems = document.querySelectorAll('.nav-item');
            navItems[0].classList.add('active');
            navItems[1].classList.remove('active');
        }
    </script>

    <script type="module" src="./jogo-da-velha.js"></script>
</body>
</html>